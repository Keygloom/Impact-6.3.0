<!-- LINE-ITEM.LIQUID - À placer dans snippets/line-item.liquid -->
{%- assign line_item_variant = line_item.variant | default: line_item -%}
{%- assign line_item_product = line_item.product | default: line_item.variant.product -%}

<div class="line-item" data-line-item-id="{{ line_item.id }}">
  <div class="h-stack gap-4">
    <!-- Image du produit -->
    <div class="line-item__media">
      {%- if line_item_variant.image != blank -%}
        <img 
          src="{{ line_item_variant.image | image_url: width: 140 }}"
          alt="{{ line_item_variant.image.alt | escape }}"
          width="70"
          height="auto"
          loading="lazy"
          class="line-item__image"
        >
      {%- else -%}
        {{ 'product-1' | placeholder_svg_tag: 'line-item__image placeholder' }}
      {%- endif -%}
    </div>

    <!-- Détails du produit -->
    <div class="line-item__info v-stack gap-2 grow">
      <!-- Titre du produit -->
      <div>
        <a href="{{ line_item_product.url }}" class="line-item__title h6">
          {{ line_item_product.title | escape }}
        </a>
        
        {%- unless line_item_product.has_only_default_variant -%}
          <div class="text-sm text-subdued">
            {%- for option in line_item.variant.options -%}
              <span>{{ option }}</span>
              {%- unless forloop.last -%} / {%- endunless -%}
            {%- endfor -%}
          </div>
        {%- endunless -%}

        {%- if line_item.selling_plan_allocation -%}
          <div class="text-sm text-subdued">
            {{ line_item.selling_plan_allocation.selling_plan.name | escape }}
          </div>
        {%- endif -%}
      </div>

      <!-- Section Prix avec nouveau style -->
      <div class="line-item__price-section">
        <div class="h-stack gap-2 items-center flex-wrap">
          {%- if line_item_variant.compare_at_price > line_item_variant.price -%}
            {%- assign savings = line_item_variant.compare_at_price | minus: line_item_variant.price -%}
            {%- assign savings_percentage = savings | times: 100.0 | divided_by: line_item_variant.compare_at_price | round -%}
            
            <!-- Prix actuel en vert -->
            <span class="line-item__sale-price" style="color: #10b981; font-weight: 600; font-size: 16px;">
              {{ line_item.final_price | money }}
            </span>
            
            <!-- Prix original barré -->
            <span class="line-item__compare-price" style="text-decoration: line-through; color: #9ca3af; font-size: 14px;">
              {{ line_item_variant.compare_at_price | money }}
            </span>
            
            <!-- Badge SAVE -->
            <span class="line-item__save-badge" style="
              background-color: #ef4444;
              color: white;
              padding: 2px 6px;
              border-radius: 4px;
              font-size: 11px;
              font-weight: 600;
              white-space: nowrap;
            ">
              SAVE {{ savings | money }}
            </span>
          {%- else -%}
            <!-- Prix normal si pas de promotion -->
            <span class="line-item__regular-price" style="font-weight: 600; font-size: 16px;">
              {{ line_item.final_price | money }}
            </span>
          {%- endif -%}
        </div>

        <!-- Réductions sur la ligne -->
        {%- if line_item.line_level_discount_allocations.size > 0 -%}
          <div class="line-item__discounts text-sm">
            {%- for discount_allocation in line_item.line_level_discount_allocations -%}
              <div class="badge badge--discount">
                {%- render 'icon' with 'discount', width: 12, height: 12 -%}
                <span>{{ discount_allocation.discount_application.title }}</span>
                <span>(-{{ discount_allocation.amount | money }})</span>
              </div>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>

      <!-- Sélecteur de quantité -->
      <div class="line-item__quantity">
        <quantity-selector class="quantity-selector">
          <button type="button" class="quantity-selector__button" aria-label="{{ 'cart.general.decrease_quantity' | t }}" data-quantity-decrease>
            {%- render 'icon' with 'minus', width: 12, height: 12 -%}
          </button>
          <input 
            type="number" 
            name="updates[]" 
            value="{{ line_item.quantity }}" 
            min="0"
            class="quantity-selector__input"
            aria-label="{{ 'cart.general.quantity' | t }}"
            data-line-item-id="{{ line_item.id }}"
          >
          <button type="button" class="quantity-selector__button" aria-label="{{ 'cart.general.increase_quantity' | t }}" data-quantity-increase>
            {%- render 'icon' with 'plus', width: 12, height: 12 -%}
          </button>
        </quantity-selector>
      </div>
    </div>

    <!-- Bouton supprimer -->
    <div class="line-item__remove">
      <cart-remove-button data-line-item-id="{{ line_item.id }}">
        <button type="button" class="line-item__remove-button" aria-label="{{ 'cart.general.remove' | t }}">
          {%- render 'icon' with 'trash', width: 14, height: 14 -%}
        </button>
      </cart-remove-button>
    </div>
  </div>
</div>

<style>
  .line-item {
    padding: 1rem 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  }

  .line-item:last-child {
    border-bottom: none;
  }

  .line-item__media {
    flex-shrink: 0;
  }

  .line-item__image {
    width: 70px;
    height: auto;
    object-fit: cover;
    border-radius: 8px;
  }

  .line-item__title {
    color: inherit;
    text-decoration: none;
    font-weight: 500;
  }

  .line-item__title:hover {
    text-decoration: underline;
  }

  .quantity-selector {
    display: inline-flex;
    align-items: center;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
  }

  .quantity-selector__button {
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .quantity-selector__button:hover {
    background-color: #f3f4f6;
  }

  .quantity-selector__input {
    width: 40px;
    text-align: center;
    border: none;
    padding: 0.25rem;
    font-size: 14px;
  }

  .quantity-selector__input::-webkit-inner-spin-button,
  .quantity-selector__input::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .line-item__remove-button {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
    color: #6b7280;
    transition: color 0.2s;
  }

  .line-item__remove-button:hover {
    color: #10B981;
  }

  @media (max-width: 640px) {
    .line-item__image {
      width: 60px;
    }
    
    .line-item__save-badge {
      font-size: 10px !important;
      padding: 2px 4px !important;
    }
  }
</style>